【问题描述】

代码相似性（或代码克隆）检测广泛应用于代码优化、知识产权保护和教学领域。根据下面方法，对给定的一组C程序代码进行相似检测，并按要求输出相似性检测结果。

代码相似性检测方法：

 1．扫描每个程序，获取每个程序中用户定义函数调用关系（是指main函数直接调用其它用户定义函数情况），以及用户定义函数的关键信息流。程序中提供了实现代码的函数即为**用户定义函数**。

**函数关键信息流：**是指对用户定义函数体中去掉非关键信息后得到的信息流串，其获取方法如下：

a) 删除代码中==所有空白（空格、制表符及回车符）字符(**'\n','\r','\t',' '**)；==

b)**针对程序代码中标识符**，保留函数体中关键字及标准库函数名，其它调用用户函数名统一用“FUNC”串替换，除此之外删除所有其它标识符（标识符定义见C语言教材）。

课程平台下载区文件“project2024.zip”中keepwords.txt文件包含了<u>ANSI C语言关键字表和标准库函数列表</u>。

c) 函数关键信息流包括函数体的开始’{’和结束’}’，以及所有其它字符。

2．生成每个程序的关键信息流，具体方法如下：每个程序从main函数开始，==**按函数调用序**，依次将主函数和其调用的用户定义函数的关键信息流合并一起得到程序的关键信息流。==注意为了简化算法，只将main函数直接调用的用户定义函数信息流合并一起，**间接调用（即第二层调用）不用考虑**，而且在main函数中**重复调用的函数只合并一次**。假如某程序A，main函数先后调用了fa, fb, fa, fc等函数，fa函数又调用了fd函数，只须依次将main函数、fa函数、fb函数和fc函数的关键信息流合并在一起得到该程序的关键信息流。

3．计算每个程序与其它程序的相似度值。两程序相似度值的计算方法如下：

a)   调用函数editdistDP计算2个程序间的编辑距离editDistance:

**editDistance = editdistDP(P1_keyinfo, P2_keyinfo)**

函数editdistDP的参数分别为2个程序的关键信息流串，返回值为编辑距离（≥0的整数）。文件editdistDP.c包含了函数editdistDP的实现代码，可从课程平台下载区下载文件“project2024.zip”，其中包含了editdistDP.c文件，请将该文件中全部内容粘贴到本人综合作业的代码中，以便在程序中调用editdistDP函数。

b)    根据两个程序间编辑距离，按下面公式计算两个程序的相似度：

**Sim = 1 - (double) editDistance / MAX(P1_len, P2_len)**

其中， sim为两个程序的相似度（为double类型）；P1_len和 P2_len分两个程序关键信息流串的长度；函数MAX得到2个正整数的较大数。

3．按相似度值阈值(在此，**相似度值阈值设置为0.95**)对程序进行代码相似**分类**，并按程序出现序依次在屏幕上输出代码相似性检测结果。程序代码相似**分类**方法如下：

a)   从给定的第一个程序开始，列出所有与之相似度大于某阈值的程序，将所有涉及的程序记为集合C1。

b)   若第二个程序不在C1中，列出所有与之相似度大于某阈值的程序。所有涉及的程序记为C2；否则检测第三个程序。

c)   若第三个程序不在C1,C2中，列出所有与之相似度大于某阈值的程序。所有涉及的程序记为C3…。

d)   依次类推，直至找到所有程序高相似的其它程序为止

 **相关说明：**

**1．** **编辑距离：**字符串编辑距离(Edit Distance)，是俄罗斯科学家Vladimir Levenshtein提出的概念。两个字符串之间的最小编辑距离就是指把一个字符串转换为另一个字符串时，所需要的最小编辑操作(插入、删除、替换)的次数。在此给出了一个计算两个串之间最小编辑距离算法的C实现，可从课程下载区获得相应代码，粘贴到自己编写的代码中直接使用。有关串最小编辑距离算法在网上有多个经典实现，相关原理及实现可上网查找。

**2．** **标识符：**在C语言中，标识符是指以下横线（_）或字母开头的字母数字串，可用于**变量名、函数名**、类型名、常量名、结构名...。

**3．** **函数定义形式**：在C语言中，函数定义形式如下：

<类型> 函数名(形参列表){ 函数体 }  

在处理程序时，当遇到一个标识符，其后是“(…){…}” 则该标识符是一个用户定义函数，以此来识别用户定义函数名及函数体，注意形参列表中可能会有()嵌套、函数体中也有{}嵌套。提示：可用一个标记变量来解决括号匹配问题，变量初值为0，当遇到左括号时，变量加1，遇到右括号时变量减1，当标记变量重新为0时表明2个括号是匹配的。


【输入形式】

课程平台下载区文件“project2024.zip”中包含了codes.txt、keepwords.txt和editdistDP.c等与作业实现相关的文件。codes.txt为需要进行查重的程序代码、keepwords.txt为ANSI C关键字及标准库函数列表、editdistDP.c为一种计算编辑距离算法的实现代码。

codes.txt文件中包含一组需要查重的C程序代码，每个程序首先为程序编号（一组数字），然后是实现代码（程序中函数的实现代码，注意它们不一定是按照执行顺序排列，如main函数可能出现在最前面，也可能在最后面），各程序代码以分页符\f结束，也就是说各程序间以\f字符分隔。

在此，为了简化算法实现，codes.txt文件中的程序代码数据已经过了数据清洗（数据清洗是自然语言处理NLP领域常用方法），具体做法是删除了程序代码中一些按照本文方法进行代码相似比较时不影响算法精度的一些内容，如程序的注释、字符常量和字符串常量中的内容，同时也删除了函数实现代码以外的其它代码（如包含文件、全局变量、外部数据结构定义、**函数返回类型**等）。因此，在处理程序代码时不用考虑注释、字符常量和字符串常量中是否含有如(、)、{、}等特定内容。





由于Windows系统下文本文件中的’\n’回车符在（评测环境）Linux系统下会变为’\r’和’\n’2个字符，建议用==fscanf(fp,”%s”,…)来读取keepwords.txt文件中的关键字及标准库函数名。==



【输出形式】

按程序代码在codes.txt文件中出现序输出聚类后的相似程序编号到屏幕上，即首先输出与文件中第一个程序相似（如有的话）的一组程序编号（也按代码出现序），程序编号间以一个空格分隔，最后有一个回车；然后输出与文件中第二个程序相似（如有的话）的一组程序编号（也按代码出现序），以此类推。**若所给程序代码中无相似程序，则无输出。**详见【样例输出】。



【样例输入】

从课程平台下载区下载文件“project2024.zip”到本地，按本文方法对codes.txt文件中的程序代码进行相似比较，并将比较结果聚类后按要求格式输出到屏幕上。


【样例输出】

程序正确运行后屏幕输出结果为：

100009 100020 100025

100018 110014



【样例说明】

100009、100020、100025为一组相似代码；100018、110014为另一组相似代码，组内和组间的第1个程序编号均按程序代码出现序。

为了方便同学们调试综合作业代码，将针对codes.txt中前2个程序数据的中间处理信息（如程序每个函数的关键信息流、程序关键信息流和相似度值等信息）放到debuginfo.txt文件中（包含在“project2024.zip”文件中），同学们可参考（可将这2个程序数据摘出放到一个XXX.txt文件中来调试作业程序）。


【评分标准】

本题为综合功能测试题，其评分标准为通过测试数据即可得分。程序运行无结果或结果错误将不得分。